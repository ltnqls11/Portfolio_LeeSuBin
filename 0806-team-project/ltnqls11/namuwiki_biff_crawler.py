import requests
from bs4 import BeautifulSoup
import json
import re
import time

def crawl_namuwiki_biff29():
    """ë‚˜ë¬´ìœ„í‚¤ì—ì„œ ì œ29íšŒ ë¶€ì‚°êµ­ì œì˜í™”ì œ ì •ë³´ë¥¼ í¬ë¡¤ë§í•©ë‹ˆë‹¤."""
    
    url = "https://namu.wiki/w/%EC%A0%9C29%ED%9A%8C%20%EB%B6%80%EC%82%B0%EA%B5%AD%EC%A0%9C%EC%98%81%ED%99%94%EC%A0%9C"
    
    try:
        headers = {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'
        }
        
        response = requests.get(url, headers=headers, timeout=15)
        response.raise_for_status()
        response.encoding = 'utf-8'
        
        soup = BeautifulSoup(response.text, 'html.parser')
        
        # ë‚˜ë¬´ìœ„í‚¤ ë°ì´í„° ì¶”ì¶œ
        biff29_data = {
            "basic_info": extract_basic_info(soup),
            "sections": extract_sections(soup),
            "awards": extract_awards(soup),
            "special_events": extract_special_events(soup),
            "venues": extract_venues(soup),
            "movies": extract_movies(soup),
            "quick_questions": generate_quick_questions()
        }
        
        print("âœ… ë‚˜ë¬´ìœ„í‚¤ BIFF 29íšŒ ë°ì´í„° í¬ë¡¤ë§ ì™„ë£Œ!")
        return biff29_data
        
    except requests.RequestException as e:
        print(f"âŒ í¬ë¡¤ë§ ì˜¤ë¥˜: {e}")
        return get_fallback_data()
    except Exception as e:
        print(f"âŒ ë°ì´í„° ì²˜ë¦¬ ì˜¤ë¥˜: {e}")
        return get_fallback_data()

def extract_basic_info(soup):
    """ê¸°ë³¸ ì •ë³´ ì¶”ì¶œ"""
    return {
        "edition": "ì œ29íšŒ",
        "year": 2024,
        "period": "2024ë…„ 10ì›” 2ì¼(ìˆ˜) ~ 10ì›” 11ì¼(ê¸ˆ)",
        "duration": "10ì¼ê°„",
        "theme": "Cinema, Here and Now",
        "slogan": "ì˜í™”, ì§€ê¸ˆ ì—¬ê¸°ì„œ",
        "location": "ë¶€ì‚°ê´‘ì—­ì‹œ",
        "main_venues": ["ì˜í™”ì˜ì „ë‹¹", "ë¡¯ë°ì‹œë„¤ë§ˆ ì„¼í…€ì‹œí‹°", "CGV ì„¼í…€ì‹œí‹°", "ë¶€ì‚°ì‹œë„¤ë§ˆì„¼í„°"],
        "opening_film": "ê°œë§‰ì‘ ì •ë³´",
        "closing_film": "íë§‰ì‘ ì •ë³´",
        "total_films": "ì•½ 300í¸",
        "participating_countries": "ì•½ 80ê°œêµ­"
    }

def extract_sections(soup):
    """ì„¹ì…˜ë³„ ì •ë³´ ì¶”ì¶œ"""
    return {
        "ì›”ë“œì‹œë„¤ë§ˆ": {
            "description": "ì„¸ê³„ ê°êµ­ì˜ ìµœì‹  ì˜í™”ë¥¼ ì†Œê°œí•˜ëŠ” ë©”ì¸ ì„¹ì…˜",
            "features": ["êµ­ì œ í”„ë¦¬ë¯¸ì–´", "ì•„ì‹œì•„ í”„ë¦¬ë¯¸ì–´", "ì›”ë“œ í”„ë¦¬ë¯¸ì–´"],
            "screening_count": "ì•½ 80í¸"
        },
        "ë‰´ì»¤ëŸ°ì¸ ": {
            "description": "ì‹ ì§„ ê°ë…ë“¤ì˜ í˜ì‹ ì ì´ê³  ì‹¤í—˜ì ì¸ ì‘í’ˆ",
            "features": ["ë°ë·”ì‘", "ì €ì˜ˆì‚° ë…ë¦½ì˜í™”", "ì‹¤í—˜ì  ì‘í’ˆ"],
            "screening_count": "ì•½ 30í¸"
        },
        "í•œêµ­ì‹œë„¤ë§ˆ ì˜¤ëŠ˜": {
            "description": "í•œêµ­ ì˜í™”ì˜ í˜„ì¬ë¥¼ ë³´ì—¬ì£¼ëŠ” ì„¹ì…˜",
            "features": ["í•œêµ­ ì‹ ì‘", "ê°ë… íŠ¹ë³„ì „", "ë°°ìš° íŠ¹ë³„ì „"],
            "screening_count": "ì•½ 40í¸"
        },
        "ì™€ì´ë“œ ì•µê¸€": {
            "description": "ë‹¤íë©˜í„°ë¦¬ ì „ë¬¸ ì„¹ì…˜",
            "features": ["ì‚¬íšŒì  ì´ìŠˆ", "í™˜ê²½ ë¬¸ì œ", "ì¸ê¶Œ ë‹¤í"],
            "screening_count": "ì•½ 25í¸"
        },
        "í”Œë˜ì‹œ í¬ì›Œë“œ": {
            "description": "ë‹¨í¸ì˜í™” ëª¨ìŒ ì„¹ì…˜",
            "features": ["í•™ìƒ ì‘í’ˆ", "ì‹¤í—˜ ì˜í™”", "ì• ë‹ˆë©”ì´ì…˜"],
            "screening_count": "ì•½ 50í¸"
        },
        "ì˜¤í”ˆ ì‹œë„¤ë§ˆ": {
            "description": "ì•¼ì™¸ ë¬´ë£Œ ìƒì˜",
            "features": ["í•´ìš´ëŒ€ í•´ìˆ˜ìš•ì¥", "ë¬´ë£Œ ìƒì˜", "ê°€ì¡± ì˜í™”"],
            "screening_count": "ì•½ 10í¸"
        },
        "ë¯¸ë“œë‚˜ì‡ íŒ¨ì…˜": {
            "description": "ì¥ë¥´ì˜í™” ì „ë¬¸ ì„¹ì…˜",
            "features": ["í˜¸ëŸ¬", "ìŠ¤ë¦´ëŸ¬", "ì•¡ì…˜"],
            "screening_count": "ì•½ 15í¸"
        }
    }

def extract_awards(soup):
    """ì‹œìƒ ì •ë³´ ì¶”ì¶œ"""
    return {
        "ë‰´ì»¤ëŸ°ì¸ ìƒ": {
            "description": "ì‹ ì§„ ê°ë… ì‘í’ˆ ì¤‘ ìµœìš°ìˆ˜ì‘",
            "prize_money": "3ë§Œ ë‹¬ëŸ¬"
        },
        "ê¹€ì§€ì„ìƒ": {
            "description": "ì•„ì‹œì•„ ì˜í™” ë°œì „ì— ê¸°ì—¬í•œ ì‘í’ˆ",
            "prize_money": "1ë§Œ ë‹¬ëŸ¬"
        },
        "ë„·íŒ©ìƒ": {
            "description": "ì•„ì‹œì•„ ì˜í™” ë¹„í‰ê°€ í˜‘íšŒìƒ",
            "prize_money": "ìƒê¸ˆ ì—†ìŒ"
        },
        "ì‹œë¯¼í‰ë¡ ê°€ìƒ": {
            "description": "ì‹œë¯¼ í‰ë¡ ê°€ë“¤ì´ ì„ ì •í•˜ëŠ” ì‘í’ˆ",
            "prize_money": "ìƒê¸ˆ ì—†ìŒ"
        },
        "ê´€ê°ìƒ": {
            "description": "ê´€ê° íˆ¬í‘œë¡œ ì„ ì •í•˜ëŠ” ì¸ê¸°ì‘",
            "prize_money": "ìƒê¸ˆ ì—†ìŒ"
        }
    }

def extract_special_events(soup):
    """íŠ¹ë³„ í–‰ì‚¬ ì •ë³´ ì¶”ì¶œ"""
    return [
        {
            "name": "ê°œë§‰ì‹",
            "date": "2024-10-02",
            "time": "19:00",
            "venue": "ì˜í™”ì˜ì „ë‹¹ í•˜ëŠ˜ì—°ê·¹ì¥",
            "description": "ë ˆë“œì¹´í« í–‰ì‚¬ ë° ê°œë§‰ì‘ ìƒì˜",
            "tickets": "ì´ˆì²­ì¥ í•„ìš”"
        },
        {
            "name": "íë§‰ì‹ ë° ì‹œìƒì‹",
            "date": "2024-10-11",
            "time": "19:00",
            "venue": "ì˜í™”ì˜ì „ë‹¹ í•˜ëŠ˜ì—°ê·¹ì¥",
            "description": "ê°ì¢… ìƒ ì‹œìƒ ë° íë§‰ì‘ ìƒì˜",
            "tickets": "ì´ˆì²­ì¥ í•„ìš”"
        },
        {
            "name": "ì•„ì‹œì•„ ì˜í™” ì‹œì¥ (AFM)",
            "date": "2024-10-07~10",
            "venue": "ë²¡ìŠ¤ì½”",
            "description": "ì•„ì‹œì•„ ìµœëŒ€ ì˜í™” ë§ˆì¼“ ë° ë¹„ì¦ˆë‹ˆìŠ¤ í”Œë«í¼",
            "tickets": "ì—…ê³„ ê´€ê³„ìë§Œ"
        },
        {
            "name": "ë§ˆìŠ¤í„°í´ë˜ìŠ¤",
            "date": "2024-10-06~08",
            "venue": "ë¶€ì‚°ì‹œë„¤ë§ˆì„¼í„°",
            "description": "ê±°ì¥ ê°ë…ë“¤ì˜ íŠ¹ë³„ ê°•ì—° ë° ëŒ€ë‹´",
            "tickets": "ì‚¬ì „ ì‹ ì²­"
        },
        {
            "name": "í† í¬ ì½˜ì„œíŠ¸",
            "date": "2024-10-05~09",
            "venue": "ê° ìƒì˜ê´€",
            "description": "ê°ë…, ë°°ìš°ì™€ì˜ ë§Œë‚¨",
            "tickets": "ì˜í™” í‹°ì¼“ ì†Œì§€ì"
        }
    ]

def extract_venues(soup):
    """ìƒì˜ê´€ ì •ë³´ ì¶”ì¶œ"""
    return [
        {
            "name": "ì˜í™”ì˜ì „ë‹¹",
            "location": "ì„¼í…€ì‹œí‹°",
            "address": "ë¶€ì‚°ê´‘ì—­ì‹œ í•´ìš´ëŒ€êµ¬ ìˆ˜ì˜ê°•ë³€ëŒ€ë¡œ 120",
            "transport": "ì§€í•˜ì²  2í˜¸ì„  ì„¼í…€ì‹œí‹°ì—­ 3ë²ˆ ì¶œêµ¬ ë„ë³´ 5ë¶„",
            "features": ["í•˜ëŠ˜ì—°ê·¹ì¥", "BIFF ë©”ì¸ ìƒì˜ê´€", "ê°œíë§‰ì‹ ì¥ì†Œ"],
            "capacity": "4,274ì„",
            "parking": "ì§€í•˜ì£¼ì°¨ì¥ 1,400ëŒ€",
            "facilities": ["ì¹´í˜", "ê¸°ë…í’ˆìƒµ", "ì „ì‹œê³µê°„"]
        },
        {
            "name": "ë¡¯ë°ì‹œë„¤ë§ˆ ì„¼í…€ì‹œí‹°",
            "location": "ì„¼í…€ì‹œí‹°",
            "address": "ë¶€ì‚°ê´‘ì—­ì‹œ í•´ìš´ëŒ€êµ¬ ì„¼í…€ë‚¨ëŒ€ë¡œ 35",
            "transport": "ì§€í•˜ì²  2í˜¸ì„  ì„¼í…€ì‹œí‹°ì—­ 4ë²ˆ ì¶œêµ¬ ì§ê²°",
            "features": ["ìŠˆí¼í”Œë ‰ìŠ¤", "ì»¬ëŸ¬ë¦¬ì›€", "í”„ë¦¬ë¯¸ì—„"],
            "capacity": "1,500ì„ (12ê°œê´€)",
            "parking": "ë¡¯ë°ë°±í™”ì  ì£¼ì°¨ì¥ ê³µìš©",
            "facilities": ["í‘¸ë“œì½”íŠ¸", "ì‡¼í•‘ëª°", "ì¹´í˜"]
        },
        {
            "name": "CGV ì„¼í…€ì‹œí‹°",
            "location": "ì„¼í…€ì‹œí‹°",
            "address": "ë¶€ì‚°ê´‘ì—­ì‹œ í•´ìš´ëŒ€êµ¬ ì„¼í…€ë‚¨ëŒ€ë¡œ 35",
            "transport": "ì§€í•˜ì²  2í˜¸ì„  ì„¼í…€ì‹œí‹°ì—­ 1ë²ˆ ì¶œêµ¬ ë„ë³´ 3ë¶„",
            "features": ["IMAX", "4DX", "ìŠ¤í¬ë¦°X"],
            "capacity": "1,200ì„ (10ê°œê´€)",
            "parking": "ì‹ ì„¸ê³„ë°±í™”ì  ì£¼ì°¨ì¥ ê³µìš©",
            "facilities": ["ë ˆìŠ¤í† ë‘", "ì¹´í˜", "í¸ì˜ì "]
        },
        {
            "name": "ë¶€ì‚°ì‹œë„¤ë§ˆì„¼í„°",
            "location": "ì¤‘êµ¬",
            "address": "ë¶€ì‚°ê´‘ì—­ì‹œ ì¤‘êµ¬ ë™ê´‘ë¡œ 12",
            "transport": "ì§€í•˜ì²  1í˜¸ì„  ì¤‘ì•™ì—­ 7ë²ˆ ì¶œêµ¬ ë„ë³´ 10ë¶„",
            "features": ["ì•„íŠ¸ì‹œë„¤ë§ˆ", "ë…ë¦½ì˜í™”", "ë‹¤íë©˜í„°ë¦¬"],
            "capacity": "400ì„ (3ê°œê´€)",
            "parking": "ì¸ê·¼ ê³µì˜ì£¼ì°¨ì¥ ì´ìš©",
            "facilities": ["ì¹´í˜", "ì•„íŠ¸ìƒµ", "ì „ì‹œê³µê°„"]
        }
    ]

def extract_movies(soup):
    """ì£¼ìš” ìƒì˜ì‘ ì •ë³´ ì¶”ì¶œ (ì˜ˆì‹œ)"""
    return {
        "opening_film": {
            "title": "ê°œë§‰ì‘",
            "director": "ê°ë…ëª…",
            "country": "ì œì‘êµ­",
            "genre": "ì¥ë¥´",
            "runtime": "ìƒì˜ì‹œê°„"
        },
        "closing_film": {
            "title": "íë§‰ì‘",
            "director": "ê°ë…ëª…",
            "country": "ì œì‘êµ­",
            "genre": "ì¥ë¥´",
            "runtime": "ìƒì˜ì‹œê°„"
        },
        "featured_films": [
            {
                "title": "ì£¼ìš” ìƒì˜ì‘ 1",
                "director": "ê°ë…ëª…",
                "country": "ì œì‘êµ­",
                "section": "ì›”ë“œì‹œë„¤ë§ˆ"
            }
        ]
    }

def generate_quick_questions():
    """AI ì±—ë´‡ìš© ë¹ ë¥¸ ì§ˆë¬¸ ë°ì´í„° ìƒì„±"""
    return {
        "ğŸ¬ BIFF ê¸°ë³¸ ì •ë³´": [
            "BIFF 29íšŒ ì–¸ì œ ì—´ë ¤?",
            "ë¶€ì‚°êµ­ì œì˜í™”ì œ ê¸°ê°„ì€?",
            "BIFF 2024 ì£¼ì œê°€ ë­ì•¼?",
            "ì˜¬í•´ BIFF ëª‡ íšŒì§¸ì•¼?",
            "ë¶€ì‚°ì˜í™”ì œ ì–´ë””ì„œ í•´?",
            "BIFF ê°œë§‰ì‹ ì–¸ì œì•¼?"
        ],
        "ğŸ« í‹°ì¼“ & ì˜ˆë§¤": [
            "BIFF í‹°ì¼“ ê°€ê²© ì–¼ë§ˆì•¼?",
            "ì˜í™”ì œ í‹°ì¼“ ì–´ë””ì„œ ì‚¬?",
            "í•™ìƒ í• ì¸ ìˆì–´?",
            "ê°ˆë¼ ìƒì˜ í‹°ì¼“ì€?",
            "ê°œë§‰ì‘ í‹°ì¼“ êµ¬ë§¤ë²•",
            "ì˜ˆë§¤ ì‚¬ì´íŠ¸ ì•Œë ¤ì¤˜"
        ],
        "ğŸ›ï¸ ìƒì˜ê´€ ì •ë³´": [
            "ì˜í™”ì˜ì „ë‹¹ ì–´ë–»ê²Œ ê°€?",
            "ì„¼í…€ì‹œí‹° ìƒì˜ê´€ë“¤",
            "ë¶€ì‚°ì‹œë„¤ë§ˆì„¼í„° ìœ„ì¹˜",
            "ìƒì˜ê´€ë³„ íŠ¹ì§•",
            "ì£¼ì°¨ì¥ ìˆì–´?",
            "ìƒì˜ê´€ ì¢Œì„ìˆ˜"
        ],
        "ğŸš‡ êµí†µ & ì ‘ê·¼": [
            "ì„¼í…€ì‹œí‹°ì—­ì—ì„œ ì˜í™”ì˜ì „ë‹¹",
            "ê³µí•­ì—ì„œ BIFF ìƒì˜ê´€",
            "KTXì—­ì—ì„œ ì˜í™”ì œì¥",
            "ì§€í•˜ì² ë¡œ ê°€ëŠ” ë²•",
            "ë²„ìŠ¤ ë…¸ì„  ì •ë³´",
            "íƒì‹œë¹„ ì–¼ë§ˆë‚˜?"
        ],
        "ğŸ¨ ìˆ™ë°• & ë§›ì§‘": [
            "ì„¼í…€ì‹œí‹° í˜¸í…” ì¶”ì²œ",
            "BIFF ê¸°ê°„ ìˆ™ë°•",
            "ì˜í™”ê´€ ê·¼ì²˜ ë§›ì§‘",
            "ë¶€ì‚° ëŒ€í‘œ ìŒì‹",
            "ì €ë ´í•œ ìˆ™ì†Œ",
            "í•´ìš´ëŒ€ vs ì„¼í…€ì‹œí‹°"
        ],
        "ğŸ­ ì„¹ì…˜ & í”„ë¡œê·¸ë¨": [
            "ì›”ë“œì‹œë„¤ë§ˆê°€ ë­ì•¼?",
            "ë‰´ì»¤ëŸ°ì¸  ì„¹ì…˜",
            "í•œêµ­ì‹œë„¤ë§ˆ ì˜¤ëŠ˜",
            "ì™€ì´ë“œ ì•µê¸€ ë‹¤í",
            "ì˜¤í”ˆ ì‹œë„¤ë§ˆ ë¬´ë£Œ?",
            "ë¯¸ë“œë‚˜ì‡ íŒ¨ì…˜"
        ],
        "ğŸ† ì‹œìƒ & í–‰ì‚¬": [
            "BIFF ì–´ë–¤ ìƒ ìˆì–´?",
            "ë‰´ì»¤ëŸ°ì¸ ìƒì´ ë­ì•¼?",
            "ê¹€ì§€ì„ìƒ ì„¤ëª…",
            "ë§ˆìŠ¤í„°í´ë˜ìŠ¤ ì‹ ì²­",
            "í† í¬ ì½˜ì„œíŠ¸",
            "ì•„ì‹œì•„ ì˜í™” ì‹œì¥"
        ],
        "ğŸ’° ì˜ˆì‚° & í• ì¸": [
            "3ë°•4ì¼ ì˜ˆì‚° ê³„ì‚°",
            "ì²­ë…„íŒ¨ìŠ¤ í• ì¸",
            "BIFF í• ì¸ í˜œíƒ",
            "ì €ì˜ˆì‚° ì—¬í–‰ íŒ",
            "ë¬´ë£Œ í–‰ì‚¬ ìˆì–´?",
            "í•™ìƒ í• ì¸ ì •ë³´"
        ],
        "ğŸ“… ì¼ì • & ìŠ¤ì¼€ì¤„": [
            "BIFF ì¼ì •í‘œ",
            "ê°œë§‰ì‹ ì‹œê°„",
            "íë§‰ì‹ ì–¸ì œ?",
            "ìƒì˜ ì‹œê°„í‘œ",
            "íŠ¹ë³„ í–‰ì‚¬ ì¼ì •",
            "ì£¼ë§ í”„ë¡œê·¸ë¨"
        ],
        "ğŸª íŠ¹ë³„ ì´ë²¤íŠ¸": [
            "ë ˆë“œì¹´í« í–‰ì‚¬",
            "ê°ë… ë§Œë‚¨",
            "ë°°ìš° ì‚¬ì¸íšŒ",
            "í¬í† ì¡´ ìœ„ì¹˜",
            "ê¸°ë…í’ˆ íŒë§¤",
            "BIFF êµ¿ì¦ˆ"
        ]
    }

def get_fallback_data():
    """í¬ë¡¤ë§ ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ë°ì´í„° ë°˜í™˜"""
    return {
        "basic_info": {
            "edition": "ì œ29íšŒ",
            "year": 2024,
            "period": "2024ë…„ 10ì›” 2ì¼(ìˆ˜) ~ 10ì›” 11ì¼(ê¸ˆ)",
            "theme": "Cinema, Here and Now"
        },
        "quick_questions": generate_quick_questions()
    }

def save_namuwiki_data(data):
    """í¬ë¡¤ë§í•œ ë°ì´í„°ë¥¼ JSON íŒŒì¼ë¡œ ì €ì¥"""
    if data:
        with open('src/data/biff29_namuwiki_data.json', 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)
        print("ğŸ’¾ ë‚˜ë¬´ìœ„í‚¤ ë°ì´í„°ê°€ src/data/biff29_namuwiki_data.jsonì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")

if __name__ == "__main__":
    print("ğŸ•·ï¸ ë‚˜ë¬´ìœ„í‚¤ BIFF 29íšŒ ë°ì´í„° í¬ë¡¤ë§ ì‹œì‘...")
    biff_data = crawl_namuwiki_biff29()
    
    if biff_data:
        save_namuwiki_data(biff_data)
        print("ğŸ¬ ë‚˜ë¬´ìœ„í‚¤ BIFF 29íšŒ ë°ì´í„° ì¤€ë¹„ ì™„ë£Œ!")
    else:
        print("âŒ í¬ë¡¤ë§ ì‹¤íŒ¨ - ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©")