# ğŸ—„ï¸ Supabase ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”
VDT ì¦í›„êµ° ê´€ë¦¬ ì‹œìŠ¤í…œì„ ìœ„í•œ í¬ê´„ì ì¸ Supabase ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆì…ë‹ˆë‹¤.

## ğŸ¯ ì£¼ìš” í…Œì´ë¸” êµ¬ì¡°

### 1. **users** - ì‚¬ìš©ì ê¸°ë³¸ ì •ë³´
- ì´ë©”ì¼, ì´ë¦„, ë‚˜ì´, ì„±ë³„, ê·¼ë¬´ ê²½ë ¥ ë“± ê¸°ë³¸ ì •ë³´ ì €ì¥

### 2. **user_conditions** - ì‚¬ìš©ì ì¦ìƒ ê´€ë¦¬
- ê±°ë¶ëª©, ëª©ë””ìŠ¤í¬, ì†ëª©í„°ë„ì¦í›„êµ° ë“± ê° ì¦ìƒë³„ ê´€ë¦¬
- í†µì¦ ì ìˆ˜ ë° ìƒíƒœ ì¶”ì 

### 3. **work_environment** - ì‘ì—… í™˜ê²½ í‰ê°€
- ëª¨ë‹ˆí„° ê±°ë¦¬, ì˜ì í¸ì•ˆí•¨, ì¡°ëª… ë“± í™˜ê²½ í‰ê°€ ë°ì´í„°
- í™˜ê²½ ì ìˆ˜ ê³„ì‚° ë° ì €ì¥

### 4. **exercise_survey** - ê°œì¸ ìš´ë™ ì„¤ë¬¸
- ìš´ë™ ë¹ˆë„, ì„ í˜¸ ì‹œê°„, ê°€ëŠ¥í•œ ìš”ì¼ ë“±
- ê°œì¸ ë§ì¶¤ ìš´ë™ ê³„íš ìˆ˜ë¦½ìš© ë°ì´í„°

### 5. **exercise_management** - ìš´ë™ ê´€ë¦¬ ê¸°ë¡
- ì¼ì¼ ìš´ë™ ì™„ë£Œ ê¸°ë¡
- í†µì¦ ë°ì´í„° ê¸°ë¡
- ê¸°ì¡´ ì‹œìŠ¤í…œê³¼ í˜¸í™˜

### 6. **exercise_routines** - ìš´ë™ ë£¨í‹´ ì¶”ì²œ
- AIê°€ ì¶”ì²œí•œ ìš´ë™ ë£¨í‹´
- ì™„ë£Œìœ¨ ë° í”¼ë“œë°± ì €ì¥

### 7. **video_watch_history** - YouTube ì˜ìƒ ì‹œì²­ ê¸°ë¡
- ì‹œì²­í•œ ìš´ë™ ì˜ìƒ ê¸°ë¡
- íš¨ê³¼ì„± í‰ê°€ ë° ì™„ë£Œìœ¨

### 8. **pain_tracking** - ìƒì„¸ í†µì¦ ì¶”ì 
- ì•„ì¹¨, ì˜¤í›„, ì €ë…ë³„ í†µì¦ ë ˆë²¨
- í†µì¦ ìœ ë°œ ìš”ì¸ ë° ì™„í™” ë°©ë²•

### 9. **notification_settings** - ì•Œë¦¼ ì„¤ì •
- ì´ë©”ì¼/Slack ì•Œë¦¼ ì„¤ì •
- íœ´ì‹ ê°„ê²© ë° ê·¼ë¬´ ì‹œê°„ ì„¤ì •

### 10. **consultation_history** - AI ìƒë‹´ ê¸°ë¡
- ì‚¬ìš©ìì™€ AI ì „ë¬¸ì˜ ëŒ€í™” ê¸°ë¡
- ë§Œì¡±ë„ í‰ê°€ ë° í›„ì† ì¡°ì¹˜

### 11. **exercise_effectiveness** - ìš´ë™ íš¨ê³¼ ë¶„ì„
- ì£¼ê°„/ì›”ê°„ í†µì¦ ê°œì„ ìœ¨
- ê°€ì¥ íš¨ê³¼ì ì¸ ìš´ë™ ë¶„ì„

### 12. **usage_statistics** - ì‹œìŠ¤í…œ ì‚¬ìš© í†µê³„
- ê¸°ëŠ¥ë³„ ì‚¬ìš© íšŸìˆ˜
- ì‚¬ìš© íŒ¨í„´ ë¶„ì„

## ğŸš€ ì„¤ì¹˜ ë°©ë²•

### 1ë‹¨ê³„: Supabase í”„ë¡œì íŠ¸ ì ‘ì†
1. [Supabase Dashboard](https://app.supabase.com)ì— ë¡œê·¸ì¸
2. í”„ë¡œì íŠ¸ ì„ íƒ
3. SQL Editor ì—´ê¸°

### 2ë‹¨ê³„: ìŠ¤í‚¤ë§ˆ ì‹¤í–‰
1. `supabase_schema.sql` íŒŒì¼ì˜ ë‚´ìš©ì„ ë³µì‚¬
2. SQL Editorì— ë¶™ì—¬ë„£ê¸°
3. "Run" ë²„íŠ¼ í´ë¦­

### 3ë‹¨ê³„: ê¶Œí•œ ì„¤ì • (ì„ íƒì‚¬í•­)
```sql
-- ìµëª… ì‚¬ìš©ìì—ê²Œ ì½ê¸°/ì“°ê¸° ê¶Œí•œ ë¶€ì—¬ (ê°œë°œìš©)
GRANT ALL ON ALL TABLES IN SCHEMA public TO anon;
GRANT ALL ON ALL SEQUENCES IN SCHEMA public TO anon;
GRANT ALL ON ALL FUNCTIONS IN SCHEMA public TO anon;
```

### 4ë‹¨ê³„: í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
`.env` íŒŒì¼ì— ë‹¤ìŒ ì •ë³´ ì¶”ê°€:
```env
SUPABASE_URL=your-project-url
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_KEY=your-service-key
```

## ğŸ“Š ì£¼ìš” ë·° (View)

### user_comprehensive_view
ì‚¬ìš©ìì˜ ëª¨ë“  ì •ë³´ë¥¼ í•œ ë²ˆì— ì¡°íšŒí•  ìˆ˜ ìˆëŠ” ì¢…í•© ë·°

### weekly_progress_view
ì£¼ê°„ ìš´ë™ ë° í†µì¦ ì¶”ì„¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ” ë·°

## ğŸ”§ ìœ ìš©í•œ ì¿¼ë¦¬

### ì‚¬ìš©ì í†µì¦ ê°œì„ ìœ¨ í™•ì¸
```sql
SELECT * FROM calculate_pain_improvement('user@email.com');
```

### ìµœê·¼ 7ì¼ê°„ ìš´ë™ ê¸°ë¡ ì¡°íšŒ
```sql
SELECT * FROM exercise_management 
WHERE user_email = 'user@email.com' 
  AND date >= CURRENT_DATE - INTERVAL '7 days'
  AND data_type = 'exercise_log'
ORDER BY date DESC;
```

### í˜„ì¬ í™œì„± ì¦ìƒ ì¡°íšŒ
```sql
SELECT * FROM user_conditions 
WHERE user_email = 'user@email.com' 
  AND status = 'active';
```

## ğŸ” ë³´ì•ˆ ì„¤ì •

### RLS (Row Level Security)
- ëª¨ë“  í…Œì´ë¸”ì— RLS í™œì„±í™”
- ì‚¬ìš©ìëŠ” ìì‹ ì˜ ë°ì´í„°ë§Œ ì ‘ê·¼ ê°€ëŠ¥
- ê´€ë¦¬ìëŠ” ëª¨ë“  ë°ì´í„° ì ‘ê·¼ ê°€ëŠ¥

### ì¸ì¦ ì—°ë™
Supabase Authì™€ ì—°ë™í•˜ì—¬ ì‚¬ìš©:
```javascript
const { data, error } = await supabase
  .from('users')
  .select('*')
  .eq('email', user.email)
```

## ğŸ“ˆ ëª¨ë‹ˆí„°ë§

### ëŒ€ì‹œë³´ë“œ ì¿¼ë¦¬
```sql
-- ì¼ì¼ í™œì„± ì‚¬ìš©ì
SELECT COUNT(DISTINCT user_email) as daily_active_users
FROM exercise_management
WHERE date = CURRENT_DATE;

-- í‰ê·  í†µì¦ ê°œì„ ìœ¨
SELECT AVG(pain_improvement_percentage) as avg_improvement
FROM exercise_effectiveness
WHERE created_at >= CURRENT_DATE - INTERVAL '30 days';

-- ê°€ì¥ ì¸ê¸° ìˆëŠ” ìš´ë™ ì˜ìƒ
SELECT video_title, COUNT(*) as watch_count
FROM video_watch_history
GROUP BY video_title
ORDER BY watch_count DESC
LIMIT 10;
```

## ğŸ†˜ ë¬¸ì œ í•´ê²°

### í…Œì´ë¸”ì´ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê²½ìš°
```sql
-- ê¸°ì¡´ í…Œì´ë¸” ì‚­ì œ (ì£¼ì˜: ë°ì´í„° ì†ì‹¤)
DROP TABLE IF EXISTS table_name CASCADE;
```

### ê¶Œí•œ ì˜¤ë¥˜ ë°œìƒ ì‹œ
```sql
-- ê¶Œí•œ ì¬ì„¤ì •
GRANT ALL PRIVILEGES ON DATABASE postgres TO postgres;
```

## ğŸ“ ë§ˆì´ê·¸ë ˆì´ì…˜

### ê¸°ì¡´ ë°ì´í„° ì´ì „
```sql
-- customer_history ë°ì´í„°ë¥¼ ìƒˆ êµ¬ì¡°ë¡œ ì´ì „
INSERT INTO users (email, created_at)
SELECT DISTINCT email, MIN(created_at) 
FROM customer_history
GROUP BY email
ON CONFLICT (email) DO NOTHING;

-- ì¦ìƒ ë°ì´í„° ì´ì „
INSERT INTO user_conditions (user_email, condition_name, pain_score)
SELECT 
  email,
  jsonb_array_elements_text(conditions::jsonb) as condition_name,
  (pain_scores::jsonb->>jsonb_array_elements_text(conditions::jsonb))::integer as pain_score
FROM customer_history;
```

## ğŸ“ ì§€ì›

ë¬¸ì œê°€ ë°œìƒí•˜ê±°ë‚˜ ë„ì›€ì´ í•„ìš”í•œ ê²½ìš°:
- Supabase ê³µì‹ ë¬¸ì„œ: https://supabase.com/docs
- í”„ë¡œì íŠ¸ ì´ìŠˆ íŠ¸ë˜ì»¤: GitHub Issues

---

*ìµœì¢… ì—…ë°ì´íŠ¸: 2024-08-24*